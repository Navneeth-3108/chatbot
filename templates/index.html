<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Expirex Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Expirex Chatbot</h1>
        <div id="chat-box">
            <!-- Initial bot message -->
            <div class="message bot">
                This is a chatbot created to clarify your doubts in the project Expirex.
            </div>
        </div>
        <div class="input-group">
            <input type="text" id="user-input" placeholder="Type your question..." autocomplete="off" />
            <button id="send-btn">Send</button>
        </div>
        <div id="suggestions"></div>
    </div>
    <script>
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const messages = document.getElementById('chat-box');
        const suggestionsDiv = document.getElementById('suggestions');

        // Fetch and show suggestions as user types
        userInput.addEventListener('input', function() {
            const query = userInput.value.trim();
            if (query.length === 0) {
                suggestionsDiv.innerHTML = '';
                return;
            }
            fetch(`/suggest?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    suggestionsDiv.innerHTML = '';
                    (data.suggestions || []).forEach(s => {
                        const div = document.createElement('div');
                        div.className = 'suggestion';
                        div.textContent = s;
                        div.onclick = () => {
                            userInput.value = s;
                            suggestionsDiv.innerHTML = '';
                            userInput.focus();
                        };
                        suggestionsDiv.appendChild(div);
                    });
                });
        });

        // Send message to backend and display response
        function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;
            // Show user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = text;
            messages.appendChild(userMsg);
            userInput.value = '';
            suggestionsDiv.innerHTML = '';
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;

            // Send to backend
            fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            })
            .then(res => res.json())
            .then(data => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                botMsg.textContent = data.response || data.error || "No response";
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
            });
        }

        sendBtn.onclick = sendMessage;
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>